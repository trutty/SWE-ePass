/*
* Kendo UI Beta v2013.1.226 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.list.min"],function(){(function(e,t){function n(e,t){var n;if(null===e&&null!==t||null!==e&&null===t)return!1;if(n=e.length,n!==t.length)return!1;for(;n--;)if(e[n]!==t[n])return!1;return!0}function a(e){var t=e.firstChild;return t&&"none"===t.style.display&&(t=l(t,w)),t}function i(e){var t=e.lastChild;return t&&"none"===t.style.display&&(t=l(t,b)),t}function l(e,t){return e=e[t],e&&"none"===e.style.display&&(e=l(e,t)),e}function r(t,n){t.filters&&(t.filters=e.grep(t.filters,function(e){return r(e,n),e.filters?e.filters.length:e.field!=n}))}var s=window.kendo,o=s.ui,u=o.List,c=s.keys,d=e.proxy,p="id",_="li",h="accept",f="filter",g="open",v="close",m="change",y="progress",T="select",w="nextSibling",b="previousSibling",S=' style="display:none"',k="aria-disabled",x="k-state-focused",C="k-state-hover",I="k-state-disabled",L="disabled",F=".kendoMultiSelect",B="click"+F,D="mouseenter"+F,E="mouseleave"+F,H=D+" "+E,V=/"/g,A=["font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","text-transform","line-height"],W=u.extend({init:function(e,t){var n,a,i=this;i.ns=F,u.fn.init.call(i,e,t),i._wrapper(),i._tagList(),i._input(),i._textContainer(),i._loader(),i._tabindex(i.input),t=i.options,e=i.element.attr("multiple","multiple").hide(),t.placeholder||(t.placeholder=e.data("placeholder")),i.input.on("keydown"+F,d(i._keydown,i)).on("paste"+F,d(i._search,i)).on("focus"+F,function(){i._placeholder(!1)}).on("blur"+F,function(){i._placeholder(),i.close(),i._state===f&&(i._state=h)}),n=e.attr(p),n&&(i._tagID=n+"_tag_active",n+="_taglist",i.tagList.attr(p,n)),i._aria(n),i._dataSource(),i._ignoreCase(),i._accessors(),i._popup(),i._values=[],i._dataItems=[],a=t.value||e.val(),null===a&&(a=[]),i._old=i._initialValues=a,i._setInitialValues=!!a[0],i._reset(),i._enable(),i._placeholder(),t.autoBind&&i.dataSource.fetch(),s.notify(i)},options:{name:"MultiSelect",enable:!0,autoBind:!0,highlightFirst:!0,dataTextField:"",dataValueField:"",filter:"startswith",ignoreCase:!0,minLength:0,delay:100,maxSelectedItems:null,itemTemplate:"",tagTemplate:"",placeholder:"",height:200,animation:{}},events:[g,v,m,T,"dataBinding","dataBound"],setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},setOptions:function(e){u.fn.setOptions.call(this,e),this._template(),this._accessors(),this._aria(this.tagList.attr(p))},current:function(e){return this.currentTag(null),u.fn.current.call(this,e)},currentTag:function(e){var n=this;return e===t?n._currentTag:(n._currentTag&&(n._currentTag.removeClass(x).removeAttr(p),n.input.removeAttr("aria-activedescendant")),e&&(e.addClass(x).attr(p,n._tagID),n.input.attr("aria-activedescendant",n._tagID)),n._currentTag=e,t)},dataItems:function(){return this._dataItems},destroy:function(){var e=this,t=e.ns;e.wrapper.off(t),e.tagList.off(t),e.input.off(t),u.fn.destroy.call(e)},enable:function(t){var n=this,a=n.wrapper.off(F),i=n.tagList.off(F),l=n.input.add(n.element);t===!1?(a.addClass(I),l.attr(L,L).attr(k,!0)):(l.removeAttr(L).attr(k,!1),a.removeClass(I).on(H,n._toggleHover).on("mousedown"+F,function(e){e.preventDefault(),-1==e.target.className.indexOf("k-delete")&&n.open(),n.input[0]!==document.activeElement&&n.input.focus()}),i.on(D,_,function(){e(this).addClass(C)}).on(E,_,function(){e(this).removeClass(C)}).on(B,".k-delete",function(t){n._unselect(e(t.target).closest(_)),n._change(),n.close()}))},close:function(){this.popup.close(),this.current(null)},open:function(){var t=this;t.ul[0].firstChild&&t._state!==h?t._visibleItems&&t._allowSelection()&&(t.popup.open(),t.current(t.options.highlightFirst?e(a(t.ul[0])):null)):(t._state="",t._open=!0,t._filterSource())},toggle:function(e){this[e?g:v]()},refresh:function(){var t,n=this,i=null;n.trigger("dataBinding"),t=n._render(n.dataSource.view()),n._height(t),n._setInitialValues&&(n._setInitialValues=!1,n.value(n._initialValues)),n._open&&(n._open=!1,n.toggle(t)),n.popup.visible()&&n.options.highlightFirst&&(i=e(a(n.ul[0]))),n.current(i),n._touchScroller&&n._touchScroller.reset(),n._makeUnselectable(),n._hideBusy(),n.trigger("dataBound")},search:function(e){var t=this,n=t.options,a=n.ignoreCase,i=n.filter,l=n.dataTextField;clearTimeout(t._typing),e="string"==typeof e?e:t.input.val(),e.length>=n.minLength&&(t._state=f,t._open=!0,t._filterSource({value:a?e.toLowerCase():e,field:l,operator:i,ignoreCase:a}))},value:function(n){var a,i=this,l=e(i.tagList[0].children),r=l.length,s=0;if(n===t)return i._values;if(!i._fetchItems(n)){for(;r>s;s++)i._unselect(l.eq(s));if(null!==n){for(n=e.isArray(n)?n:[n],s=0,r=n.length;r>s;s++)a=i._index(n[s]),a>-1&&i._select(a);i._old=i._values.slice()}}},_dataSource:function(){var t=this,n=t.element,a=t.options,i=a.dataSource||{};i=e.isArray(i)?{data:i}:i,i.select=n,i.fields=[{field:a.dataTextField},{field:a.dataValueField}],t.dataSource&&t._refreshHandler?t._unbindDataSource():(t._refreshHandler=d(t.refresh,t),t._progressHandler=d(t._showBusy,t)),t.dataSource=s.data.DataSource.create(i).bind(m,t._refreshHandler).bind(y,t._progressHandler)},_fetchItems:function(e){var n=this;return n._fetch||n.ul[0].firstChild?t:(n.dataSource.one(m,function(){n.value(e),n._fetch=!1}),n._fetch=!0,n.dataSource.fetch(),!0)},_reset:function(){var e=this,t=e.element,n=t.closest("form");n[0]&&(e._resetHandler=function(){setTimeout(function(){e.value(e._initialValues)})},e._form=n.on("reset",e._resetHandler))},_filterSource:function(e){var t=this,n=t.options,a=t.dataSource,i=a.filter()||{};r(i,n.dataTextField),e&&(i=i.filters||[],i.push(e)),a.filter(i)},_change:function(){var e=this,t=e.value();n(t,e._old)||(e._old=t.slice(),e.trigger(m),e.element.trigger(m))},_click:function(n){var a=this,i=e(n.currentTarget);if(!n.isDefaultPrevented()){if(a.trigger(T,{item:i}))return a.close(),t;a._select(i),a._change(),a.close()}},_item:function(e,t){return e=e[t](),e[0]&&!e.is(":visible")&&(e=this._item(e,t)),e},_keydown:function(n){var r=this,o=n.keyCode,u=r._currentTag,d=r._current,p=r.input.val(),_=s.support.isRtl(r.wrapper),h=r.popup.visible();if(o===c.DOWN){if(n.preventDefault(),!h)return r.open(),t;d=d?l(d[0],w):r.ul[0].firstChild,d&&r.current(e(d))}else o===c.UP?(h&&(d=d?l(d[0],b):r.ul[0].lastChild,r.current(e(d)),r._current[0]||r.close()),n.preventDefault()):o===c.LEFT&&!_||o===c.RIGHT&&_?p||(u=u?u.prev():e(r.tagList[0].lastChild),u[0]&&r.currentTag(u)):o===c.RIGHT&&!_||o===c.LEFT&&_?!p&&u&&(u=u.next(),r.currentTag(u[0]?u:null)):o===c.ENTER?h&&(r._select(d),r._change(),r.close(),n.preventDefault()):o===c.ESC?(h?n.preventDefault():r.currentTag(null),r.close()):o===c.HOME?h?r.current(e(a(r.ul[0]))):p||(u=r.tagList[0].firstChild,u&&r.currentTag(e(u))):o===c.END?h?r.current(e(i(r.ul[0]))):p||(u=r.tagList[0].lastChild,u&&r.currentTag(e(u))):o!==c.DELETE&&o!==c.BACKSPACE||p?r._search():(o!==c.BACKSPACE||u||(u=e(r.tagList[0].lastChild)),u&&u[0]&&(r._unselect(u),r._change(),r.close()))},_hideBusy:function(){var e=this;clearTimeout(e._busy),e._loading.hide(),e.input.attr("aria-busy",!1),e._busy=null},_showBusy:function(){var e=this;e._busy||(e._busy=setTimeout(function(){e.input.attr("aria-busy",!0),e._loading.show()},100))},_placeholder:function(e){var n=this,a=n.input;e===t?(e=!1,a[0]!==document.activeElement&&(e=!n._dataItems[0]),n.wrapper.removeClass(x)):n.wrapper.addClass(x),a.toggleClass("k-readonly",e).val(e?n.options.placeholder:""),n._scale()},_scale:function(){var e=this,t=e.wrapper.width(),n=e._span.text(e.input.val()).width()+25;e.input.width(n>t?t:n)},_option:function(e,n){var a="<option",i=this._text(e),l=this._value(e);return l!==t&&(l+="",-1!==l.indexOf('"')&&(l=l.replace(V,"&quot;")),a+=' value="'+l+'"'),n&&(a+=' selected="selected"'),a+=">",i!==t&&(a+=s.htmlEncode(i)),a+="</option>"},_render:function(e){for(var t,n,a=this,i=e.length,l=a.itemTemplate,r=a._dataItems.slice(0),s=0,o=0,u="",c="";i>o;o++)t=e[o],n=a._selected(r,t),c+=l(t,o,n),u+=a._option(t,n),n||(s+=1);if(i=r.length)for(o=0;i>o;o++)u+=a._option(r[o],!0);return a.ul[0].innerHTML=c,a.element.html(u),a._visibleItems=s,s},_selected:function(e,n){var a,i=this,l=i._text,r=i._value,s=r(n),o=e.length,u=!1,c=0;for(s===t&&(s=l(n));o>c;c++)if(n=e[c],a=r(n),a===t&&(a=l(n)),a!==t&&a===s){u=!0;break}return u&&e.splice(c,1),u},_search:function(){var e=this;e._typing=setTimeout(function(){var t=e.input.val();e._prev!==t&&(e._scale(),e._prev=t,e.search(t))},e.options.delay)},_allowSelection:function(){var e=this.options.maxSelectedItems;return null===e||e>this._values.length},_select:function(e){var t,n,a=this,i=a._values;a._allowSelection()&&(isNaN(e)?n=e.hide().data("idx"):(n=e,a.ul[0].children[n].style.display="none"),a.element[0].children[n].selected=!0,t=a.dataSource.view()[n],a.tagList.append(a.tagTemplate(t)),a._dataItems.push(t),i.push(a._dataValue(t)),a._visibleItems-=1,a.currentTag(null),a._placeholder(),a._state===f&&(a._state=h))},_unselect:function(t){var n,a,i,l,r,s=this,o=t.index();if(t.remove(),s.currentTag(null),s._values.splice(o,1),n=s._dataItems.splice(o,1)[0],a=s._dataValue(n),o=s._index(a),-1!==o)e(s.ul[0].children[o]).show(),s.element[0].children[o].selected=!1,s._visibleItems+=1;else for(o=s.dataSource.view().length,i=s.element[0].children,r=i.length;r>o;o++)if(l=i[o],l.value==a){l.selected=!1;break}s._placeholder()},_template:function(){var e,t=this,n=t.options,a=n.itemTemplate,i=n.tagTemplate,l=n.dataSource;t.element[0].length&&!l&&(n.dataTextField=n.dataTextField||"text",n.dataValueField=n.dataValueField||"value"),e=s.template("#:"+s.expr(n.dataTextField,"data")+"#",{useWithBlock:!1}),a=a?s.template(a):e,i=i?s.template(i):e,t.itemTemplate=function(e,t,n){return'<li tabindex="-1" role="option" data-idx="'+t+'" unselectable="on" class="k-item"'+(n?S:"")+">"+a(e)+"</li>"},t.tagTemplate=function(e){return'<li class="k-button"><span>'+i(e)+'</span><span class="k-icon k-delete">delete</span></li>'}},_input:function(){var t=this,n=t.element[0].accessKey,a=t._innerWrapper.children("input.k-input");a[0]||(a=e('<input class="k-input" style="width: 25px" />').appendTo(t._innerWrapper)),t.element.removeAttr("accesskey"),t._focused=t.input=a.attr({accesskey:n,role:"listbox","aria-expanded":!1})},_tagList:function(){var t=this,n=t._innerWrapper.children("ul");n[0]||(n=e('<ul role="listbox" unselectable="on" class="k-reset"/>').appendTo(t._innerWrapper)),t.tagList=n},_loader:function(){this._loading=e('<span class="k-loading" style="display:none"></span>').insertAfter(this.input)},_textContainer:function(){var t=s.getComputedStyles(this.input[0],A);t.position="absolute",t.visibility="hidden",this._span=e("<span/>").css(t).appendTo(this.wrapper)},_wrapper:function(){var t=this,n=t.element,a=n.parent("span.k-multiselect");a[0]||(a=n.wrap('<div class="k-widget k-multiselect k-header" />').parent(),a[0].style.cssText=n[0].style.cssText,e('<div class="k-multiselect-wrap floatWrap" />').insertBefore(n)),t.wrapper=a.addClass(n[0].className).css("display",""),t._innerWrapper=e(a[0].firstChild)}});o.plugin(W)})(window.kendo.jQuery)});